{% extends "admin/base_layout.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{% if errors %}{% translate "Error:" %} {% endif %}{{ block.super }}{% endblock %}
{% block extrahead %}{{ block.super }}
<script src="{% url 'admin:jsi18n' %}"></script>
{{ media }}
<script>
        document.addEventListener('DOMContentLoaded', function() {
            const wrappers = document.querySelectorAll('.related-widget-wrapper');

            wrappers.forEach(wrapper => {
                const iconLinks = wrapper.querySelectorAll('.related-widget-wrapper-link');
                if (iconLinks.length > 0) {
                    const iconContainer = document.createElement('div');
                    iconContainer.className = 'related-widget-icon-container';

                    iconLinks.forEach(link => {
                        iconContainer.appendChild(link);
                    });
                    wrapper.appendChild(iconContainer);
                }
            });
        });
    </script>
{% endblock %}

{% block extrastyle %}{{ block.super }}
<style>
        .related-widget-wrapper {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-direction: column;
        }
        @media (min-width: 640px) {
          .related-widget-wrapper {
              flex-direction: row;
          }
        }
        .related-widget-icon-container {
          display: flex;
          flex-direction: row;
        }
        .related-widget-wrapper select {
            flex-grow: 1;
        }
        .related-widget-wrapper-link {
            flex-shrink: 0;
            display: inline-block;
            width: 1.75rem;
            height: 1.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            transition: background-color 150ms ease-in-out;
        }
        .related-widget-wrapper-link:not([href]) {
          opacity: 0.4;
          cursor: not-allowed;
        }
        a.related-widget-wrapper-link:hover {
            background-color: #f3f4f6;
        }
        .dark a.related-widget-wrapper-link:hover {
            background-color: #374151;
        }
        .related-widget-wrapper-link img {
            width: 1.25rem;
            height: 1.25rem;
        }
    </style>
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% if not is_popup %}
{% block breadcrumbs %}
  <div class="breadcrumbs text-sm mb-4 px-6 py-3 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <a href="{% url 'admin:index' %}" class="text-blue-600 hover:underline dark:text-blue-400">{% translate 'Home' %}</a>
      <span class="mx-2 text-gray-400">&rsaquo;</span>
      <a href="{% url 'admin:app_list' app_label=opts.app_label %}" class="text-blue-600 hover:underline dark:text-blue-400">{{ opts.app_config.verbose_name }}</a>
      <span class="mx-2 text-gray-400">&rsaquo;</span>
      {% if has_view_permission %}
          <a href="{% url opts|admin_urlname:'changelist' %}" class="text-blue-600 hover:underline dark:text-blue-400">{{ opts.verbose_name_plural|capfirst }}</a>
      {% else %}
          {{ opts.verbose_name_plural|capfirst }}
      {% endif %}
      <span class="mx-2 text-gray-400">&rsaquo;</span>
      <span class="text-gray-600 dark:text-gray-300">
          {% if add %}{% blocktranslate with name=opts.verbose_name %}Add {{ name }}{% endblocktranslate %}{% else %}{{ original|truncatewords:"18" }}{% endif %}
      </span>
  </div>
{% endblock %}
{% endif %}

{% block main_content %}<div id="content-main" class="flex flex-col gap-3">
{% block object-tools %}
{% if change and not is_popup %}
  <ul class="object-tools">
    {% block object-tools-items %}
      {% change_form_object_tools %}
    {% endblock %}
  </ul>
{% endif %}
{% endblock %}
<form {% if has_file_field %}enctype="multipart/form-data" {% endif %}{% if form_url %}action="{{ form_url }}" {% endif %}method="post" id="{{ opts.model_name }}_form" novalidate class="dark:text-white">{% csrf_token %}{% block form_top %}{% endblock %}
<div class="flex flex-col gap-3">
{% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1">{% endif %}
{% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}">{% endif %}
{% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}
{% if errors %}
    <p class="errornote">
    {% blocktranslate count counter=errors|length %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktranslate %}
    </p>
    {{ adminform.form.non_field_errors }}
{% endif %}

{% block field_sets %}
{% for fieldset in adminform %}
  {% include "admin/includes/fieldset.html" with heading_level=2 prefix="fieldset" id_prefix=0 id_suffix=forloop.counter0 %}
{% endfor %}
{% endblock %}

{% block after_field_sets %}{% endblock %}

{% block inline_field_sets %}
{% for inline_admin_formset in inline_admin_formsets %}
    {% include inline_admin_formset.opts.template %}
{% endfor %}
{% endblock %}

{% block after_related_objects %}{% endblock %}

{% block submit_buttons_bottom %}{% submit_row %}{% endblock %}

{% block admin_change_form_document_ready %}
    <script id="django-admin-form-add-constants"
            src="{% static 'admin/js/change_form.js' %}"
            {% if adminform and add %}
                data-model-name="{{ opts.model_name }}"
            {% endif %}
            async>
    </script>
{% endblock %}

{# JavaScript for prepopulated fields #}
{% prepopulated_fields_js %}

</div>
</form></div>
{% endblock %}
