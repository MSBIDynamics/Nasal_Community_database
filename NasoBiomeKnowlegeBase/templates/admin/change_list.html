{% extends "admin/base_layout.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    #result_list tbody td {
      padding-left: 1.5rem;
      padding-right: 1.5rem;
      padding-top: 0.75rem;
      padding-bottom: 0.75rem;
      white-space: nowrap;
      font-size: 0.875rem;
      line-height: 1.25rem;
      color: #4B5563;
    }
  
    #result_list tbody td:first-child a {
      font-weight: 600;
      color: #111827;
    }
  
    #result_list input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
  
    #result_list td:first-child input[type="checkbox"] {
      margin: 0 auto;
      display: block;
    }
  </style>
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  {% if cl.formset or action_form %}<script src="{% url 'admin:jsi18n' %}"></script>{% endif %}
  {{ media.js }}
  <script src="{% static 'admin/js/filters.js' %}" defer></script>
{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-list{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block main_content %}
  {# Initialize Alpine.js state for this component #}
  <div id="content-main" x-data="{ filtersOpen: false }">
    
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">{{ cl.opts.verbose_name_plural|capfirst }}</h1>
      {% block object-tools %}
        <div class="object-tools">
          {% block object-tools-items %}{% change_list_object_tools %}{% endblock %}
        </div>
      {% endblock %}
    </div>

    {% if cl.formset and cl.formset.errors %}
      <div class="p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800" role="alert">
        <span class="font-medium">{% blocktranslate count counter=cl.formset.total_error_count %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktranslate %}</span>
        {{ cl.formset.non_form_errors }}
      </div>
    {% endif %}

    <div class="bg-white dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-800">
      <!-- Card Header with Title and Buttons -->
      <div class="flex flex-col gap-4 p-4 border-b border-gray-200 dark:border-gray-800 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h2 class="text-lg font-semibold text-gray-800 dark:text-white/90">
            All {{ cl.opts.verbose_name_plural|capfirst }}
          </h2>
        </div>
        <div class="flex items-center gap-3">
          {% if cl.has_filters %}
          <button @click="filtersOpen = !filtersOpen" class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700/50">
            <svg class="h-5 w-5 text-gray-500 dark:text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.572a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" /></svg>
            {% translate 'Filter' %}
          </button>
          {% endif %}
        </div>
      </div>

      <!-- Collapsible Section for Search, Filters, and Actions -->
      <div x-show="filtersOpen" x-transition class="p-4 border-b border-gray-200 dark:border-gray-800">
        <div class="flex flex-col gap-6 ">
          <div class="md:col-span-2">
            {% block search %}{% search_form cl %}{% endblock %}
          </div>
          
          {% if cl.has_filters %}
            <div id="changelist-filter" class="md:col-span-2">
              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90 mb-2">{% translate "Filter by" %}</h3>
              {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
      
      <form id="changelist-form" method="post"{% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %} novalidate>
        {% csrf_token %}
        {% if cl.formset %}{{ cl.formset.management_form }}{% endif %}
        
        {% if action_form and actions_on_top and cl.show_admin_actions %}
          <div class="p-4 border-b border-gray-200 dark:border-gray-800">
              {% admin_actions %}
          </div>
        {% endif %}
        
        {% block result_list %}
          {% result_list cl %}
        {% endblock %}

        {% if action_form and actions_on_bottom and cl.show_admin_actions %}
            <div class="p-4 border-t border-gray-200 dark:border-gray-800">
                {% admin_actions %}
            </div>
        {% endif %}
      </form>
    </div>

    <div class="mt-6">
      {% block pagination %}{% pagination cl %}{% endblock %}
    </div>

  </div>
{% endblock %}